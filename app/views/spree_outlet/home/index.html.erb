<%# Preload some data.  This seems verbose but what if you want to preload across different dynamic history routes? %>
<% content_for :header do -%>
  <script>
    window.PRELOAD = (window.PRELOAD || {});
    <% if @user %>
      $.extend(window.PRELOAD, {api_key: "<%= @user.spree_api_key %>"});
      $.extend(window.PRELOAD, { user: {
        user_id: "<%= @user.id %>",
        api_key: "<%= @user.spree_api_key %>",
        email: "<%= @user.email %>"
        }
      });
    <% end %>
    <% if @order %>
    $.extend(window.PRELOAD, { cart: <%= render(:file => 'spree/api/orders/show').html_safe %>});
    <% end %>
  </script>
<% end -%>
